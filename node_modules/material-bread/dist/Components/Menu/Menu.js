var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf3=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireWildcard(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _reactNative=require("react-native");var _withTheme=_interopRequireDefault(require("../../Theme/withTheme"));var _Menu=_interopRequireDefault(require("./Menu.styles"));var _ModalMenu=_interopRequireDefault(require("./ModalMenu"));var _jsxFileName="/Users/cody/projects/material-bread/src/Components/Menu/Menu.js";var Menu=function(_Component){(0,_inherits2.default)(Menu,_Component);function Menu(){var _getPrototypeOf2;var _this;(0,_classCallCheck2.default)(this,Menu);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=(0,_possibleConstructorReturn2.default)(this,(_getPrototypeOf2=(0,_getPrototypeOf3.default)(Menu)).call.apply(_getPrototypeOf2,[this].concat(args)));(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"state",{menuHeight:new _reactNative.Animated.Value(0),menuWidth:new _reactNative.Animated.Value(0),opacity:new _reactNative.Animated.Value(0),modalMenuWidth:0,easing:_reactNative.Easing.bezier(0.4,0,0.2,1),animationDuration:300,expanded:false});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onModalMenuLayout",function(e){var width=e.nativeEvent.layout.width;_this.setState({modalMenuWidth:width});});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onButtonLayout",function(e){var _e$nativeEvent$layout=e.nativeEvent.layout,width=_e$nativeEvent$layout.width,height=_e$nativeEvent$layout.height;var locationX,locationY;if(_reactNative.Platform.OS==='web'){locationX=e.nativeEvent.target.getBoundingClientRect().x;locationY=e.nativeEvent.target.getBoundingClientRect().y;_this.setState({buttonWidth:width,buttonHeight:height,buttonPositionX:locationX,buttonPositionY:locationY});}else{_this.marker.measure(function(x,y,width,height,pageX,pageY){locationX=pageX;locationY=pageY;_this.setState({buttonWidth:width,buttonHeight:height,buttonPositionX:locationX,buttonPositionY:locationY});});}});(0,_defineProperty2.default)((0,_assertThisInitialized2.default)(_this),"onMenuLayout",function(e){var _e$nativeEvent$layout2=e.nativeEvent.layout,width=_e$nativeEvent$layout2.width,height=_e$nativeEvent$layout2.height;_this.setState({initialWidth:width,initialHeight:height});});return _this;}(0,_createClass2.default)(Menu,[{key:"componentDidMount",value:function componentDidMount(){var visible=this.props.visible;if(visible){this.toggle();}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var visible=this.props.visible;if(visible!==prevProps.visible){this.toggle();}}},{key:"toggle",value:function toggle(){var _this2=this;var _this$state=this.state,initialHeight=_this$state.initialHeight,initialWidth=_this$state.initialWidth,easing=_this$state.easing,animationDuration=_this$state.animationDuration,buttonWidth=_this$state.buttonWidth;if(!initialHeight||!initialWidth){setTimeout(function(){return _this2.toggle();},100);return;}var sameWidth=this.props.sameWidth;var widthType=sameWidth?buttonWidth:initialWidth;var opacity=1;var height=initialHeight+24;var width=widthType+24;if(!this.props.visible){opacity=0;height=0;width=0;}_reactNative.Animated.parallel([_reactNative.Animated.timing(this.state.menuHeight,{toValue:height,duration:animationDuration,easing:easing,useNativeDriver:true}),_reactNative.Animated.timing(this.state.menuWidth,{toValue:width,duration:animationDuration,easing:easing,useNativeDriver:true}),_reactNative.Animated.timing(this.state.opacity,{toValue:opacity,duration:animationDuration,easing:easing,useNativeDriver:true})]).start();}},{key:"render",value:function render(){var _this3=this;var _this$state2=this.state,menuHeight=_this$state2.menuHeight,menuWidth=_this$state2.menuWidth,opacity=_this$state2.opacity,buttonWidth=_this$state2.buttonWidth,buttonPositionY=_this$state2.buttonPositionY,buttonPositionX=_this$state2.buttonPositionX,modalMenuWidth=_this$state2.modalMenuWidth,initialWidth=_this$state2.initialWidth,initialHeight=_this$state2.initialHeight;var _this$props=this.props,button=_this$props.button,children=_this$props.children,menuStyle=_this$props.menuStyle,modalMenuStyle=_this$props.modalMenuStyle,sameWidth=_this$props.sameWidth,visible=_this$props.visible,onBackdropPress=_this$props.onBackdropPress,contentContainerStyle=_this$props.contentContainerStyle,tooltip=_this$props.tooltip,tooltipPosition=_this$props.tooltipPosition,noBackDrop=_this$props.noBackDrop,testID=_this$props.testID,fullWidth=_this$props.fullWidth;var menuContainerStyle={height:menuHeight,width:menuWidth,opacity:opacity,top:buttonPositionY?buttonPositionY-14:0};if(modalMenuWidth>0){if(buttonPositionX>modalMenuWidth/2){menuContainerStyle.right=modalMenuWidth-buttonPositionX-buttonWidth;}else{menuContainerStyle.left=buttonPositionX-10;}}if(tooltip){menuContainerStyle.top=buttonPositionY-initialHeight-12;menuContainerStyle.left=buttonPositionX-8+buttonWidth/2-initialWidth/2;if(tooltipPosition=='bottom'){menuContainerStyle.top=buttonPositionY+initialHeight+(_reactNative.Platform.OS=='web'?4:-4);}else if(tooltipPosition=='right'){menuContainerStyle.top=buttonPositionY-(_reactNative.Platform.OS=='web'?4:8);menuContainerStyle.left=buttonPositionX-8+buttonWidth;}else if(tooltipPosition=='left'){menuContainerStyle.top=buttonPositionY-(_reactNative.Platform.OS=='web'?4:8);menuContainerStyle.left=buttonPositionX-12-initialWidth;}}if(Number.isNaN(menuContainerStyle.top)||Number.isNaN(menuContainerStyle.left)){menuContainerStyle.top=0;menuContainerStyle.left=0;}return _react.default.createElement(_reactNative.View,{testID:testID,__source:{fileName:_jsxFileName,lineNumber:222}},_react.default.createElement(_reactNative.View,{onLayout:this.onButtonLayout,ref:function ref(_ref){_this3.marker=_ref;},style:{alignSelf:'flex-start',width:fullWidth?'100%':'auto'},__source:{fileName:_jsxFileName,lineNumber:223}},button),_react.default.createElement(_ModalMenu.default,{onLayout:this.onModalMenuLayout,animationType:'none',visible:visible,onBackdropPress:onBackdropPress,noBackDrop:noBackDrop,transparent:true,__source:{fileName:_jsxFileName,lineNumber:234}},_react.default.createElement(_reactNative.Animated.View,{useNativeDriver:true,style:[_Menu.default.menuContainer,menuContainerStyle,modalMenuStyle],__source:{fileName:_jsxFileName,lineNumber:241}},_react.default.createElement(_reactNative.View,{style:[_Menu.default.menu,{width:sameWidth?buttonWidth:'auto'},menuStyle],onLayout:this.onMenuLayout,__source:{fileName:_jsxFileName,lineNumber:244}},_react.default.createElement(_reactNative.ScrollView,{contentContainerStyle:[{paddingVertical:8},contentContainerStyle],__source:{fileName:_jsxFileName,lineNumber:251}},children)))));}}]);return Menu;}(_react.Component);(0,_defineProperty2.default)(Menu,"propTypes",{button:_propTypes.default.node,children:_propTypes.default.node,onHidden:_propTypes.default.func,style:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.array]),visible:_propTypes.default.bool,menuStyle:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.array]),sameWidth:_propTypes.default.bool,onBackdropPress:_propTypes.default.func,modalMenuStyle:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.array]),contentContainerStyle:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.array]),noBackDrop:_propTypes.default.bool,tooltip:_propTypes.default.bool,tooltipPosition:_propTypes.default.string,testID:_propTypes.default.string,fullWidth:_propTypes.default.bool});var _default=(0,_withTheme.default)(Menu);exports.default=_default;